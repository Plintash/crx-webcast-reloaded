{"version":3,"sources":["../../../1-dev/popup/js/popup.js"],"names":[],"mappings":"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","file":"popup.js","sourcesContent":["// -----------------------------------------------------------------------------\r\n\r\nconst state = {}\r\n\r\n// https://developer.chrome.com/docs/extensions/reference/storage/#usage\r\nconst get_options = () => {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.storage.sync.get(\r\n      ['user_options_json'],\r\n      function(items){\r\n        try {\r\n          const data = JSON.parse(items.user_options_json)\r\n          if (!data || !Array.isArray(data.urls) || !data.urls.length || !data.contexts)\r\n            throw new Error('bad data format')\r\n\r\n          state.user_options = data\r\n          resolve()\r\n        }\r\n        catch(e) {\r\n          reject()\r\n        }\r\n      }\r\n    )\r\n  })\r\n}\r\n\r\n// https://developer.chrome.com/docs/extensions/reference/tabs/#method-query\r\nconst get_tab_id = () => {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.tabs.query(\r\n      {active: true, lastFocusedWindow: true},\r\n      function(matching_tabs_array){\r\n        const tab_id = (matching_tabs_array && Array.isArray(matching_tabs_array) && matching_tabs_array.length)\r\n          ? matching_tabs_array[0].id\r\n          : null\r\n\r\n        if (tab_id && (tab_id !== chrome.tabs.TAB_ID_NONE)) {\r\n          state.tab_id = tab_id\r\n          resolve()\r\n        }\r\n        else {\r\n          reject()\r\n        }\r\n      }\r\n    )\r\n  })\r\n}\r\n\r\n// https://developer.chrome.com/docs/extensions/reference/extension/#method-getBackgroundPage\r\nconst get_background_window = () => {\r\n  state.bg_window = chrome.extension.getBackgroundPage()\r\n}\r\n\r\nconst initialize_state = async () => {\r\n  await get_options()\r\n  await get_tab_id()\r\n\r\n  get_background_window()\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\n\r\nconst encode_link = (str, double_urlencode) => {\r\n  if (!str || (typeof str !== 'string'))\r\n    return ''\r\n\r\n  str = window.btoa(str)\r\n  str = encodeURIComponent(str)\r\n  if (double_urlencode) {\r\n    // note: workaround for bug in Angular JS $routeProvider\r\n    // link: https://stackoverflow.com/questions/16630912\r\n    str = encodeURIComponent(str)\r\n  }\r\n  return str\r\n}\r\n\r\nconst is_https = (url) => (url.substring(0,6).toLowerCase() === 'https:')\r\n\r\nconst baseurl_suffix_regex_pattern = /\\/(index\\.html)?$/i\r\n\r\nconst get_contextualized_baseurls = (https) => {\r\n  const urls = {\r\n    entrypoint: '_text_link',\r\n    chromecast: '_chromecast',\r\n    airplay:    '_airplay',\r\n    proxy:      '_proxy'\r\n  }\r\n\r\n  for (const key in urls) {\r\n    const context_key = `http${https ? 's' : ''}${urls[key]}`\r\n    const url_index   = state.user_options.contexts[ context_key ] - 1  // users enter 1-based indices on options page. subtract 1 to shift to 0-based indices for array access.\r\n    const url         = state.user_options.urls[ url_index ]\r\n\r\n    urls[key] = url\r\n  }\r\n\r\n  urls.chromecast = urls.chromecast.replace(baseurl_suffix_regex_pattern, '/chromecast_sender.html')\r\n  urls.airplay    = urls.airplay.replace(   baseurl_suffix_regex_pattern, '/airplay_sender.html')\r\n  urls.proxy      = urls.proxy.replace(     baseurl_suffix_regex_pattern, '/proxy.html')\r\n\r\n  return urls\r\n}\r\n\r\nconst get_links = (media_item) => {\r\n  const {media_url, referer_url} = media_item\r\n  const links = {}\r\n\r\n  if (!media_url)\r\n    return links\r\n\r\n  const base64_video   = encode_link(media_url,   true)\r\n  const base64_referer = encode_link(referer_url, true)\r\n\r\n  const https = is_https(media_url)\r\n  const urls  = get_contextualized_baseurls(https)\r\n  const hash  = \"#/watch/\" + base64_video + (base64_referer ? (\"/referer/\" + base64_referer) : \"\")\r\n\r\n  links.media_link = media_url\r\n  links.entrypoint = urls.entrypoint + hash\r\n  links.chromecast = urls.chromecast + hash\r\n  links.airplay    = urls.airplay    + hash\r\n  links.proxy      = urls.proxy      + hash\r\n\r\n  return links\r\n}\r\n\r\nconst process_set_media_type = (event, media_type) => {\r\n  event.preventDefault()\r\n  event.stopPropagation()\r\n\r\n  state.bg_window.set_media_type( state.tab_id, media_type )\r\n  draw_list()\r\n}\r\n\r\nconst process_click = (event, url) => {\r\n  event.preventDefault()\r\n  event.stopPropagation()\r\n\r\n  chrome.tabs.create({\r\n    windowId: chrome.windows.WINDOW_ID_CURRENT,\r\n    url\r\n  })\r\n}\r\n\r\nconst process_clear_media = (event) => {\r\n  event.preventDefault()\r\n  event.stopPropagation()\r\n\r\n  state.bg_window.clear_media( state.tab_id, true )\r\n  close_popup()\r\n}\r\n\r\nconst all_media_types = [\"videos\", \"audios\", \"captions\"]\r\n\r\nconst is_audio_video = (media_type) => (([\"videos\", \"audios\"]).indexOf(media_type) >= 0)\r\n\r\nconst hls_regex_pattern = /\\.m3u8(?:[#\\?]|$)/i\r\n\r\nconst is_hls = (url) => (hls_regex_pattern.test(url))\r\n\r\nconst App = ({media_type, media}) => {\r\n  return (\r\n    <div id=\"app\">\r\n      <div id=\"media-type-options\">\r\n        {all_media_types.map((media_type_option, index) => {\r\n          return (\r\n            <button disabled={(media_type_option === media_type)} onClick={(event) => process_set_media_type(event, media_type_option)}>{media_type_option}</button>\r\n          )\r\n        })}\r\n      </div>\r\n      <h3>{media.length} {media_type} detected on page.</h3>\r\n      <h4>Click link to transfer the media item to external website in a new tab.</h4>\r\n      <div id=\"links\">\r\n        {media.map((media_item, index) => {\r\n          const links = get_links(media_item)\r\n\r\n          return (\r\n            <div class=\"media-item\" key={index}>\r\n              <div class=\"icons-container\">\r\n                {\r\n                  (!is_audio_video(media_item.media_type)) ? null : (\r\n                    <a class=\"chromecast\" href={links.chromecast} onClick={(event) => process_click(event, links.chromecast)} title=\"Chromecast Sender\">\r\n                      <img src=\"img/chromecast.png\" />\r\n                    </a>\r\n                  )\r\n                }\r\n                {\r\n                  (!is_audio_video(media_item.media_type)) ? null : (\r\n                    <a class=\"airplay\" href={links.airplay} onClick={(event) => process_click(event, links.airplay)} title=\"ExoAirPlayer Sender\">\r\n                      <img src=\"img/airplay.png\" />\r\n                    </a>\r\n                  )\r\n                }\r\n                {\r\n                  (!is_audio_video(media_item.media_type) || !is_hls(media_item.media_url)) ? null : (\r\n                    <a class=\"proxy\" href={links.proxy} onClick={(event) => process_click(event, links.proxy)} title=\"HLS-Proxy Configuration\">\r\n                      <img src=\"img/proxy.png\" />\r\n                    </a>\r\n                  )\r\n                }\r\n                <a class=\"media-link\" href={links.media_link} onClick={(event) => process_click(event, links.media_link)} title=\"direct link to media item\">\r\n                  <img src=\"img/media_link.png\" />\r\n                </a>\r\n              </div>\r\n              <div class=\"text-container\">\r\n                <a class=\"entrypoint\" href={links.entrypoint} onClick={(event) => process_click(event, (is_audio_video(media_item.media_type) ? links.entrypoint : links.media_link))} title={links.media_link}>\r\n                  {links.media_link}\r\n                </a>\r\n              </div>\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n      <div id=\"actions\">\r\n        <button onClick={process_clear_media}>Clear {media_type} list</button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\n\r\nconst get_props = () => {\r\n  return state.bg_window.get_media( state.tab_id )\r\n}\r\n\r\nconst draw_list = () => {\r\n  const props = get_props()\r\n\r\n  if (\r\n    (props.media_type === state.media_type) &&\r\n    (props.media === state.media)\r\n  )\r\n    return\r\n\r\n  state.media_type = props.media_type\r\n  state.media      = props.media\r\n\r\n  if (!props.media || !props.media.length)\r\n    return close_popup()\r\n\r\n  ReactDOM.render(\r\n    <App {...props} />,\r\n    document.getElementById('root')\r\n  )\r\n}\r\n\r\nconst close_popup = () => {\r\n  if (state.timer)\r\n    clearInterval(state.timer)\r\n\r\n  state.timer      = null\r\n  state.media_type = null\r\n  state.media      = null\r\n  state.bg_window  = null\r\n\r\n  window.close()\r\n}\r\n\r\nconst initialize_popup = async () => {\r\n  try {\r\n    await initialize_state()\r\n\r\n    draw_list()\r\n    state.timer = setInterval(draw_list, 500)\r\n  }\r\n  catch(e) {\r\n    close_popup()\r\n  }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', initialize_popup)\r\n\r\n// -----------------------------------------------------------------------------\r\n"]}