{"version":3,"sources":["../../../1-dev/popup/js/popup.js"],"names":[],"mappings":"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","file":"popup.js","sourcesContent":["// -----------------------------------------------------------------------------\r\n\r\nconst state = {}\r\n\r\n// https://developer.chrome.com/docs/extensions/reference/storage/#usage\r\nconst get_options = () => {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.storage.sync.get(\r\n      [\"external_website_url\"],\r\n      function(items){\r\n        const url = items.external_website_url\r\n\r\n        if (url) {\r\n          state.external_website_url = url\r\n          resolve()\r\n        }\r\n        else {\r\n          reject()\r\n        }\r\n      }\r\n    )\r\n  })\r\n}\r\n\r\n// https://developer.chrome.com/docs/extensions/reference/tabs/#method-query\r\nconst get_tab_id = () => {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.tabs.query(\r\n      {active: true, lastFocusedWindow: true},\r\n      function(matching_tabs_array){\r\n        const tab_id = (matching_tabs_array && Array.isArray(matching_tabs_array) && matching_tabs_array.length)\r\n          ? matching_tabs_array[0].id\r\n          : null\r\n\r\n        if (tab_id && (tab_id !== chrome.tabs.TAB_ID_NONE)) {\r\n          state.tab_id = tab_id\r\n          resolve()\r\n        }\r\n        else {\r\n          reject()\r\n        }\r\n      }\r\n    )\r\n  })\r\n}\r\n\r\n// https://developer.chrome.com/docs/extensions/reference/extension/#method-getBackgroundPage\r\nconst get_background_window = () => {\r\n  state.bg_window = chrome.extension.getBackgroundPage()\r\n}\r\n\r\nconst initialize_state = async () => {\r\n  await get_options()\r\n  await get_tab_id()\r\n\r\n  get_background_window()\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\n\r\nconst encode_link = (str, double_urlencode) => {\r\n  if (!str || (typeof str !== 'string'))\r\n    return ''\r\n\r\n  str = window.btoa(str)\r\n  str = encodeURIComponent(str)\r\n  if (double_urlencode) {\r\n    // note: workaround for bug in Angular JS $routeProvider\r\n    // link: https://stackoverflow.com/questions/16630912\r\n    str = encodeURIComponent(str)\r\n  }\r\n  return str\r\n}\r\n\r\nconst get_links = (video) => {\r\n  const {video_url, referer_url} = video\r\n  const links = {}\r\n\r\n  if (!video_url)\r\n    return links\r\n\r\n  const base64_video   = encode_link(video_url,   true);\r\n  const base64_referer = encode_link(referer_url, true);\r\n\r\n  const url  = state.external_website_url\r\n  const hash = \"#/watch/\" + base64_video + (base64_referer ? (\"/referer/\" + base64_referer) : \"\")\r\n\r\n  links.video_link = video_url\r\n  links.entrypoint = url + hash\r\n  links.chromecast = url.replace(/\\/(index\\.html)?$/, '/chromecast_sender.html') + hash\r\n  links.airplay    = url.replace(/\\/(index\\.html)?$/, '/airplay_sender.html')    + hash\r\n  links.proxy      = url.replace(/\\/(index\\.html)?$/, '/proxy.html')             + hash\r\n\r\n  return links\r\n}\r\n\r\nconst process_click = (event, url) => {\r\n  event.preventDefault()\r\n  event.stopPropagation()\r\n\r\n  chrome.tabs.create({\r\n    windowId: chrome.windows.WINDOW_ID_CURRENT,\r\n    url\r\n  })\r\n}\r\n\r\nconst process_clear_videos = (event) => {\r\n  event.preventDefault()\r\n  event.stopPropagation()\r\n\r\n  state.bg_window.clear_videos( state.tab_id, true )\r\n  close_popup()\r\n}\r\n\r\nconst App = ({videos}) => {\r\n  return (\r\n    <div id=\"app\">\r\n      <h3>{videos.length} videos detected on page.</h3>\r\n      <h4>Click link to transfer video to external website in a new tab.</h4>\r\n      <div id=\"links\">\r\n        {videos.map((video, index) => {\r\n          const links = get_links(video)\r\n\r\n          return (\r\n            <div class=\"video-item\" key={index}>\r\n              <div class=\"icons-container\">\r\n                <a class=\"chromecast\" href={links.chromecast} onClick={(event) => process_click(event, links.chromecast)} title=\"Chromecast sender\">\r\n                  <img src=\"img/chromecast.png\" />\r\n                </a>\r\n                <a class=\"airplay\" href={links.airplay} onClick={(event) => process_click(event, links.airplay)} title=\"AirPlay sender\">\r\n                  <img src=\"img/airplay.png\" />\r\n                </a>\r\n                <a class=\"proxy\" href={links.proxy} onClick={(event) => process_click(event, links.proxy)} title=\"HLS-Proxy configuration\">\r\n                  <img src=\"img/proxy.png\" />\r\n                </a>\r\n                <a class=\"video-link\" href={links.video_link} onClick={(event) => process_click(event, links.video_link)} title=\"direct link to video\">\r\n                  <img src=\"img/video_link.png\" />\r\n                </a>\r\n              </div>\r\n              <div class=\"text-container\">\r\n                <a class=\"entrypoint\" href={links.entrypoint} onClick={(event) => process_click(event, links.entrypoint)} title={links.video_link}>\r\n                  {links.video_link}\r\n                </a>\r\n              </div>\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n      <div>\r\n        <button onClick={process_clear_videos}>Clear videos list</button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\n\r\nconst get_props = () => {\r\n  const videos = state.bg_window.get_videos( state.tab_id )\r\n  return {videos}\r\n}\r\n\r\nconst draw_list = () => {\r\n  const props = get_props()\r\n\r\n  if (props.videos === state.videos)\r\n    return\r\n\r\n  if (!props.videos || !props.videos.length)\r\n    return close_popup()\r\n\r\n  state.videos = props.videos\r\n\r\n  ReactDOM.render(\r\n    <App {...props} />,\r\n    document.getElementById('root')\r\n  )\r\n}\r\n\r\nconst close_popup = () => {\r\n  if (state.timer)\r\n    clearInterval(state.timer)\r\n\r\n  state.timer     = null\r\n  state.videos    = null\r\n  state.bg_window = null\r\n\r\n  window.close()\r\n}\r\n\r\nconst initialize_popup = async () => {\r\n  try {\r\n    await initialize_state()\r\n\r\n    draw_list()\r\n    state.timer = setInterval(draw_list, 500)\r\n  }\r\n  catch(e) {\r\n    close_popup()\r\n  }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', initialize_popup)\r\n\r\n// -----------------------------------------------------------------------------\r\n"]}